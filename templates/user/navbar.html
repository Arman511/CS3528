{% include "navgbar.html" %}
<div class="d-flex justify-content-center">
    <nav class="navbar navbar-expand-lg navbar-light">
        <button class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNav"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-center"
             id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link text-white dropdown-toggle"
                       href="#"
                       id="studentsDropdown"
                       role="button"
                       data-bs-toggle="dropdown"
                       aria-expanded="false">Students</a>
                    <div class="dropdown-menu" id="studentsMenu">
                        <a class="dropdown-item" href="{{ url_for("search_page") }}">Search</a>
                        <a class="dropdown-item" href="{{ url_for("upload_page") }}">Upload Students</a>
                        <a class="dropdown-item"
                           href="{{ url_for("register_student_attempt") }}">Add Student</a>
                        <a class="dropdown-item text-danger font-weight-bold"
                           href="#"
                           id="delete-all-students">Delete All Students</a>
                        <a class="dropdown-item" href="{{ url_for("download_all_students") }}">Download All Students</a>
                    </div>
                </li>
                <!-- <li class="nav-item {{ 'active' if page == 'students' }}">
                    <a class="nav-link text-white" href="{{ url_for("search_page") }}">Students</a>
                </li> -->
                <li class="nav-item {{ 'active' if page == 'opportunities' }}">
                    <a class="nav-link text-white"
                       href="{{ url_for("search_opportunities") }}">Opportunities</a>
                </li>
                <li class="nav-item {{ 'active' if page == 'employers' }}">
                    <a class="nav-link text-white" href="{{ url_for("search_employers") }}">Employers</a>
                </li>
                <li class="nav-item {{ 'active' if page == 'courses' }}">
                    <a class="nav-link text-white" href="{{ url_for("search_course") }}">Courses</a>
                </li>
                <li class="nav-item {{ 'active' if page == 'modules' }}">
                    <a class="nav-link text-white" href="{{ url_for("search_modules") }}">Course Modules</a>
                </li>
                <li class="nav-item {{ 'active' if page == 'skills' }}">
                    <a class="nav-link text-white" href="{{ url_for("list_skills") }}">Skills</a>
                </li>
                <li class="nav-item {{ 'active' if page == 'matching' }}">
                    <a class="nav-link text-white" href="{{ url_for("matching") }}">Matching</a>
                </li>
                <li class="nav-item {{ 'active' if page == 'problems' }}">
                    <a class="nav-link text-white" href="{{ url_for("problems") }}">Problems</a>
                </li>
                <li class="nav-item {{ 'active' if page == 'deadline' }}">
                    <a class="nav-link text-white" href="{{ url_for("deadline") }}">Change Deadline</a>
                </li>
            </ul>
        </div>
    </nav>
</div>
<script>
    // Show dropdown on hover
    const studentsDropdown = document.getElementById("studentsDropdown");
    const studentsMenu = document.getElementById("studentsMenu");

    // Show dropdown on hover over "Students"
    studentsDropdown.addEventListener("mouseenter", function () {
        studentsMenu.classList.add("show");
    });

    // Hide dropdown when mouse leaves "Students" or the menu, with slight delay for smooth exit
    studentsDropdown.addEventListener("mouseleave", function () {
        setTimeout(() => {
            if (!studentsMenu.matches(":hover")) { // Ensure the menu isn't still hovered
                studentsMenu.classList.remove("show");
            }
        }, 10); // Slight delay to prevent flickering
    });

    // Prevent menu from closing when mouse enters the dropdown menu
    studentsMenu.addEventListener("mouseenter", function () {
        this.classList.add("show");
    });

    // Hide dropdown when mouse leaves the menu
    studentsMenu.addEventListener("mouseleave", function () {
        this.classList.remove("show");
    });

    // Delete all students script
    document.getElementById("delete-all-students").addEventListener("click", async () => {
        if (confirm("Are you sure you want to delete all attempted students? This action cannot be undone.")) {
            if (confirm("This is your final warning. Do you really want to delete all attempted students?")) {
                try {
                    const response = await fetch("{{url_for('delete_all_students')}}", {
                        method: "DELETE",
                    });

                    if (response.ok) {
                        alert("All attempted students have been deleted successfully.");
                        window.location.reload();
                    } else {
                        const errorData = await response.json();
                        alert(errorData.error || "Failed to delete attempted students.");
                    }
                } catch (error) {
                    console.error(error);
                    alert("An error occurred while trying to delete attempted students.");
                }
            }
        }
    });
</script>
<style>
    .dropdown-menu {
        display: none;
        position: absolute;
        background-color: #fff;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 5px;
        padding: 10px;
        z-index: 1000;
    }

    .dropdown-menu.show {
        display: block;
    }

    .dropdown-item {
        padding: 8px 15px;
        color: black;
        text-decoration: none;
    }

    .dropdown-item:hover {
        background-color: #22699a;
        color: white;
    }
</style>
